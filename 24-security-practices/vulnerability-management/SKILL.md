# Vulnerability Management

## Vulnerability Lifecycle

### The Vulnerability Management Process

```
┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│ Discovery   │───▶│ Assessment  │───▶│ Remediation  │───▶│ Verification │───▶│  Reporting   │
│             │    │             │    │             │    │             │    │             │
│ Find vulns  │    │ Prioritize   │    │ Fix vulns    │    │ Verify fix  │    │ Document    │
└─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘
```

### Lifecycle Stages

| Stage | Description | Owner |
|-------|-------------|--------|
| **Discovery** | Find vulnerabilities | Security team, scanners |
| **Assessment** | Evaluate risk | Security team |
| **Remediation** | Fix vulnerabilities | Dev team |
| **Verification** | Confirm fix | Security team |
| **Reporting** | Document status | Security team |

## Vulnerability Sources

### Automated Scanning

| Tool | Type | What It Finds |
|-------|-------|----------------|
| **Nessus** | Vulnerability scanner | Known vulnerabilities |
| **OpenVAS** | Vulnerability scanner | Known vulnerabilities |
| **Qualys** | Vulnerability scanner | Known vulnerabilities |
| **Nikto** | Web scanner | Web server vulnerabilities |

### Manual Testing

| Method | What It Finds |
|---------|----------------|
| **Penetration testing** | Exploitable vulnerabilities |
| **Code review** | Security issues in code |
| **Configuration review** | Misconfigurations |

### Bug Bounty

| Platform | Type | What It Finds |
|----------|-------|----------------|
| **HackerOne** | Crowdsourced | Vulnerabilities reported by researchers |
| **Bugcrowd** | Crowdsourced | Vulnerabilities reported by researchers |
| **Intigriti** | Crowdsourced | Vulnerabilities reported by researchers |

### CVE Database

| Source | Type | What It Provides |
|---------|-------|------------------|
| **NVD** | National Vulnerability Database | CVE entries, CVSS scores |
| **CVE Details** | MITRE | Detailed CVE information |
| **Vendor Advisories** | Vendor | Vendor-specific vulnerability info |

## Vulnerability Scanning

### Network Scanning

```bash
# Scan with Nessus
nessus -i targets.txt -o results.xml

# Scan with Nmap (basic vulnerability detection)
nmap -sV --script vuln target.com

# Scan with OpenVAS
omp -g target.com -o results.xml
```

### Web Application Scanning

```bash
# Scan with Nikto
nikto -h https://example.com

# Scan with OWASP ZAP
zap-cli quick-scan -t https://example.com

# Scan with Burp Suite
# Use Burp's built-in scanner
```

### Dependency Scanning

```bash
# Scan with Snyk
snyk test

# Scan with npm audit
npm audit

# Scan with Dependabot
# Automatic via GitHub
```

## Dependency Scanning

### npm (Node.js)

```bash
# Check for vulnerabilities
npm audit

# Fix vulnerabilities
npm audit fix

# Use Snyk
snyk test

# Use Snyk monitor
snyk monitor
```

### pip (Python)

```bash
# Check for vulnerabilities
pip-audit

# Fix vulnerabilities
pip install --upgrade package

# Use Safety
safety check
```

### Maven (Java)

```bash
# Check with OWASP Dependency Check
mvn org.owasp:dependency-check-maven:check

# Use Snyk
snyk test --file=pom.xml
```

### Gradle (Java)

```bash
# Check with OWASP Dependency Check
gradle dependencyCheckAnalyze

# Use Snyk
snyk test --file=build.gradle
```

## Vulnerability Prioritization

### CVSS Scoring

| Metric | Range | Meaning |
|--------|-------|---------|
| **Base Score** | 0-10 | Intrinsic severity |
| **Temporal Score** | 0-10 | Adjusted for time |
| **Environmental Score** | 0-10 | Adjusted for environment |
| **Overall Score** | 0-10 | Final severity |

### Severity Levels

| CVSS Score | Severity | Response Time |
|------------|----------|---------------|
| 9.0-10.0 | Critical | < 24 hours |
| 7.0-8.9 | High | < 7 days |
| 4.0-6.9 | Medium | < 30 days |
| 0.1-3.9 | Low | < 90 days |

### Prioritization Framework

```
Risk = Likelihood × Impact × Asset Value

Where:
- Likelihood: 1-5 (Low to High)
- Impact: 1-5 (Low to High)
- Asset Value: 1-5 (Low to High)
```

### Prioritization Example

| Vulnerability | CVSS | Exploitability | Asset Value | Priority |
|--------------|-------|----------------|-------------|----------|
| SQL injection in DB | 9.8 | High (5) | Critical (5) | P0 (Critical) |
| XSS in marketing site | 6.1 | Medium (3) | Medium (3) | P2 (High) |
| Outdated library in admin | 4.3 | Low (2) | High (4) | P3 (Medium) |
| Info disclosure in footer | 2.1 | Low (1) | Low (1) | P4 (Low) |

## Patch Management

### Patch Testing

```bash
# Test patches in staging
# 1. Deploy patch to staging
# 2. Run smoke tests
# 3. Run regression tests
# 4. Monitor for issues
```

### Patch Deployment

```bash
# Deploy patch to production
# 1. Schedule maintenance window
# 2. Deploy patch
# 3. Verify deployment
# 4. Monitor for issues
```

### Rollback Plan

```bash
# Rollback if patch fails
# 1. Stop affected service
# 2. Revert to previous version
# 3. Verify rollback
# 4. Monitor for issues
```

## Virtual Patching

### WAF Rules

```nginx
# Block SQL injection attempts
location ~*\.php$ {
    if ($args ~*"(union|select|insert|delete|update|drop|create|alter|truncate|exec|script)"*) {
        return 403;
    }
}
```

### ModSecurity Rules

```apache
# Block XSS attempts
SecRule ARGS "@rx (<script|onerror|onload)" \
    "id:1001,phase:2,deny,status:403,msg:'XSS attempt detected'"
```

## Vulnerability Tracking

### Issue Tracking

| Tool | Use Case |
|------|----------|
| **Jira** | Enterprise issue tracking |
| **GitHub Issues** | Open source projects |
| **GitLab Issues** | GitLab projects |
| **Trello** | Simple project management |

### Vulnerability Database

```sql
CREATE TABLE vulnerabilities (
    id SERIAL PRIMARY KEY,
    cve_id VARCHAR(20),
    title VARCHAR(255),
    description TEXT,
    severity VARCHAR(20),
    cvss_score DECIMAL(3,1),
    status VARCHAR(20),
    discovered_date DATE,
    fixed_date DATE,
    assigned_to VARCHAR(100),
    asset_id INTEGER REFERENCES assets(id)
);

CREATE TABLE assets (
    id SERIAL PRIMARY KEY,
    name VARCHAR(255),
    type VARCHAR(50),
    owner VARCHAR(100),
    criticality VARCHAR(20)
);
```

### Status Tracking

| Status | Description |
|--------|-------------|
| **Open** | Vulnerability discovered |
| **In Progress** | Fix being developed |
| **Testing** | Fix being tested |
| **Resolved** | Fix deployed |
| **Closed** | Fix verified |

## Metrics to Track

### Key Performance Indicators

| Metric | Formula | Target |
|---------|---------|---------|
| **MTTD** | Mean Time to Detect | < 7 days |
| **MTTR** | Mean Time to Remediate | < 30 days |
| **Open Vulnerabilities** | Count of open vulns | Trending down |
| **Critical Vulns** | Count of critical vulns | 0 |
| **Patch Compliance** | % systems patched | > 95% |

### Calculating Metrics

```python
import numpy as np
from datetime import datetime, timedelta

vulnerabilities = [
    {
        'cve_id': 'CVE-2024-1234',
        'severity': 'Critical',
        'discovered_at': datetime(2024, 1, 1),
        'fixed_at': datetime(2024, 1, 3)
    },
    # ... more vulnerabilities
]

def calculate_metrics(vulnerabilities):
    """Calculate vulnerability management metrics."""
    mttt = []
    mttr = []

    for vuln in vulnerabilities:
        if vuln['fixed_at']:
            mttt.append((vuln['fixed_at'] - vuln['discovered_at']).total_seconds() / 86400)
            mttr.append((vuln['fixed_at'] - vuln['discovered_at']).total_seconds() / 86400)

    return {
        'MTTD (days)': np.mean(mttt) if mttt else 0,
        'MTTR (days)': np.mean(mttr) if mttr else 0,
        'Total Vulnerabilities': len(vulnerabilities),
        'Open Vulnerabilities': len([v for v in vulnerabilities if not v['fixed_at']])
    }

metrics = calculate_metrics(vulnerabilities)
print(metrics)
```

## Compliance Requirements

### PCI DSS

| Requirement | Description |
|-------------|-------------|
| **Regular scanning** | Quarterly external scan |
| **Patch management** | Install critical patches within 1 month |
| **Vulnerability management** | Process for managing vulns |
| **Risk assessment** | Annual risk assessment |

### SOC 2

| Requirement | Description |
|-------------|-------------|
| **Vulnerability scanning** | Regular vulnerability scanning |
| **Patch management** | Process for applying patches |
| **Monitoring** | Continuous monitoring for vulnerabilities |
| **Incident response** | Process for handling incidents |

## Tools Integration with CI/CD

### Snyk in GitHub Actions

```yaml
name: Snyk Security Scan

on: [push, pull_request]

jobs:
  security:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Run Snyk to check for vulnerabilities
        uses: snyk/actions/node@master
        env:
          SNYK_TOKEN: ${{ secrets.SNYK_TOKEN }}
```

### Dependabot

```yaml
# .github/dependabot.yml
version: 2
updates:
  - package-ecosystem: "npm"
    directory: "/"
    schedule:
      interval: "daily"
    open-pull-requests-limit: 10
    versioning-strategy: increase
    ignore:
      - dependency-name: "express"
        update-types: ["version-update:semver-patch"]
```

### OWASP Dependency Check in Maven

```xml
<plugin>
    <groupId>org.owasp</groupId>
    <artifactId>dependency-check-maven</artifactId>
    <version>8.4.0</version>
    <executions>
        <execution>
            <goals>
                <goal>check</goal>
            </goals>
        </execution>
    </executions>
</plugin>
```

## Real Examples: Critical CVE Response Workflow

### CVE-2024-1234: Critical SQL Injection

**Timeline**:

| Date | Action |
|------|--------|
| 2024-01-01 | CVE published in NVD |
| 2024-01-01 09:00 | Automated alert received |
| 2024-01-01 09:30 | Vulnerability assessed (Critical) |
| 2024-01-01 10:00 | Development team notified |
| 2024-01-01 10:30 | Patch development started |
| 2024-01-02 14:00 | Patch ready for testing |
| 2024-01-02 15:00 | Patch tested in staging |
| 2024-01-02 16:00 | Patch deployed to production |
| 2024-01-02 16:30 | Deployment verified |
| 2024-01-02 17:00 | Vulnerability marked resolved |

**Total Time**: 32 hours (within 24-hour SLA for Critical)

### Response Workflow

```
┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│  Alert      │───▶│ Assess      │───▶│ Notify      │───▶│ Fix         │───▶│ Verify      │
│             │    │             │    │             │    │             │    │             │
│ CVE         │    │ CVSS score  │    │ Assign to   │    │ Develop     │    │ Test in     │
│ published   │    │ Impact      │    │ team        │    │ patch       │    │ staging     │
└─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘
      │                  │                  │                  │                  │
      └──────────────────┴──────────────────┴──────────────────┴──────────────────┘
                                      │
                                      ▼
                              ┌─────────────┐
                              │  Deploy     │
                              │             │
                              │ Deploy to   │
                              │ production  │
                              └─────────────┘
```

## Summary Checklist

### Discovery

- [ ] Automated scanning configured
- [ ] Manual testing scheduled
- [ ] Bug bounty program active
- [ ] CVE monitoring enabled

### Assessment

- [ ] CVSS scores calculated
- [ ] Risk assessed
- [ ] Assets prioritized
- [ ] Impact evaluated

### Remediation

- [ ] Patches tested
- [ ] Rollback plan prepared
- [ ] Maintenance scheduled
- [ ] Stakeholders notified

### Verification

- [ ] Fix verified in staging
- [ ] Fix deployed to production
- [ ] Post-deployment monitoring
- [ ] Vulnerability closed

### Reporting

- [ ] Findings documented
- [ ] Remediation tracked
- [ ] Metrics calculated
- [ ] Reports distributed
